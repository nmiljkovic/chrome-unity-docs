<!doctype html>
<html>
<head>

  <title>Unity documentation extension</title>

  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
    }

    .header {
      text-align: center;
    }

    .header span {
      display: block;
    }

    .container {
      padding-top: 10px;
      padding-bottom: 20px;
      width: 874px;
      margin: 0 auto;
    }

    .anim_target, .anim_fallback {
      width: 874px;
      height: 287px;
      position: relative;
      overflow: hidden;
    }

    .unity_logo {
      margin-bottom: 10px;
    }
  </style>

</head>

<body>

  <div class="container">
    <h2 class="header">
      <img class="unity_logo" src="unity_logo.png" alt="Unity">
      <span>Google Chrome extension for Unity&reg; scripting reference</span>
    </h2>

    <canvas id="anim_target" class="anim_target" width="874" height="287">
    <div id="anim_fallback" class="anim_target" style="width: 874px; height: 287px; position: relative;">
      <img src="unity_anim_fallback.png">
    </div>
    </canvas> 

    <h2>Installation</h2>

    <p>The extension is not available in the Google Chrome Web Store yet, so you'll have to do things manually:</p>

    <ol>
      <li>
        Download the zipped extension from <a href="https://github.com/proof/chrome-unity-docs/archive/master.zip">GitHub</a>.
      </li>
      <li>
        Unzip the archive to some directory, for example <strong>c:/unity-docs/</strong>.
      </li>
      <li>
        In Google Chrome, go to <strong>Tools</strong> > <strong>Extensions</strong> and enable <strong>Developer Mode</strong>.
      </li>
      <li>
        Click on <strong>Load unpacked extension...</strong> and select the folder you unpacked the archive. (<strong>c:/unity-docs/</strong>)
      </li>
      <li>
        Start using it!
      </li>
    </ol>

    <h2>Changing the keyword</h2>

    <p>
      The default keyword for search is `unitydoc`. If that's a problem for you, you can easily change it to whatever you'd like.
    </p>

    <ol>
      <li>
        Go to the directory where the extension has been unpacked and open <strong>manifest.json</strong>
      </li>
      <li>
        Find the line that reads:
        <pre><code>"omnibox": { "keyword" : "unitydoc" }</code></pre>
      </li>
      <li>
        Change the keyword under quotes from <strong>unitydoc</strong> to something else and restart Chrome
      </li>
      <li>
        <em>(optional)</em> If you don't want to restart chrome, you can just reload the extension
        from <strong>Tools</strong> > <strong>Extensions</strong>. Find <strong>Unity Documentation</strong>,
        click on the <strong>Reload</strong> link and enjoy
      </li>
    </ol>

    <p>
      <small>
        Unity&reg; and the Unity&reg; logo are registered trademarks of Unity Technologies.
        This extension is not a product of Unity Technologies.
      </small>
    </p>
  </div>

<script type="text/javascript" src="unity_docs_anim.js"></script>
<script type="text/javascript">
// http://www.sublimetext.com/~jps/animated_gifs_the_hard_way.html
var delay_scale = 1;
var timer = null

var animate = function(img, timeline, element)
{
    var i = 0

    var run_time = 0
    for (var j = 0; j < timeline.length - 1; ++j)
        run_time += timeline[j].delay

    var f = function()
    {
        var frame = i++ % timeline.length
        var delay = timeline[frame].delay * delay_scale
        var blits = timeline[frame].blit

        var ctx = element.getContext('2d')

        for (j = 0; j < blits.length; ++j)
        {
            var blit = blits[j]
            var sx = blit[0]
            var sy = blit[1]
            var w = blit[2]
            var h = blit[3]
            var dx = blit[4]
            var dy = blit[5]
            ctx.drawImage(img, sx, sy, w, h, dx, dy, w, h)
        }

        timer = window.setTimeout(f, delay)
    }

    if (timer) window.clearTimeout(timer)
    f()
}

var animate_fallback = function(img, timeline, element)
{
    var i = 0

    var run_time = 0
    for (var j = 0; j < timeline.length - 1; ++j)
        run_time += timeline[j].delay

    var f = function()
    {
        if (i % timeline.length == 0)
        {
            while (element.hasChildNodes())
                element.removeChild(element.lastChild)
        }

        var frame = i++ % timeline.length
        var delay = timeline[frame].delay * delay_scale
        var blits = timeline[frame].blit

        for (j = 0; j < blits.length; ++j)
        {
            var blit = blits[j]
            var sx = blit[0]
            var sy = blit[1]
            var w = blit[2]
            var h = blit[3]
            var dx = blit[4]
            var dy = blit[5]

            var d = document.createElement('div')
            d.style.position = 'absolute'
            d.style.left = dx + "px"
            d.style.top = dy + "px"
            d.style.width = w + "px"
            d.style.height = h + "px"
            d.style.backgroundImage = "url('" + img.src + "')"
            d.style.backgroundPosition = "-" + sx + "px -" + sy + "px"

            element.appendChild(d)
        }

        timer = window.setTimeout(f, delay)
    }

    if (timer) window.clearTimeout(timer)
    f()
}

function set_animation(img_url, timeline, canvas_id, fallback_id)
{
    var img = new Image()
    img.onload = function()
    {
        var canvas = document.getElementById(canvas_id)
        if (canvas && canvas.getContext)
            animate(img, timeline, canvas)
        else
            animate_fallback(img, timeline, document.getElementById(fallback_id))
    }
    img.src = img_url
}

set_animation("unity_docs_packed.png", anim_timeline, 'anim_target', 'anim_fallback');
</script>

</body>
